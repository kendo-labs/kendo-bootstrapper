<!DOCTYPE html>
<html>
  <head>
    <title>Kendo UI bootstrapper</title>

    <link rel="stylesheet" type="text/css" href="kendo/css/kendo.common.css" />
    <link rel="stylesheet" type="text/css" href="kendo/css/kendo.default.css" />
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.web.min.js"></script>

    <link rel="stylesheet/less" href="css/app.less" />

    <script src="js/utils.js"></script>
    <script src="js/rpc.js"></script>
    <script src="js/less-1.3.3.min.js"></script>
    <script src="js/yajet.min.js"></script>

    <script src="js/kendo.multipicker.js"></script>
    <script src="js/kendo.layoutmanager.js"></script>
    <script src="js/directorypicker.js"></script>
    <script src="js/app.js"></script>
  </head>

  <body>

    <div id="top-layout" data-role="layoutmanager" data-orientation="horizontal">
      <div class="sections" kendo-layout="20%,min:200,resizable"
           data-role="layoutmanager" data-orientation="vertical">

        <div class="title">
          <span class="links">
            <span class="link" data-bind="click: onSettings">settings</span>
          </span>
          Projects
        </div>

        <div class="k-toolbar" style="padding: 5px">
          <button class="k-button" id="btn-project-import">Import</button>
          <button class="k-button" id="btn-project-new">New</button>
          <button class="k-button" id="btn-project-preview">Preview</button>
          |
          <button class="k-button" id="btn-project-delete">Delete</button>
        </div>

        <div id="project-list" kendo-layout="0.5,resizable" style="overflow:auto"></div>

        <div class="title">Kendo API docs</div>

        <div class="k-toolbar" style="padding: 5px">
          <label>
            Search widget:
            <input id="apidoc-search"
                   data-bind="value: search_api,
                              events: { keydown: onSearchKeydown,
                                        change: onSearchChange }" />
          </label>
        </div>

        <div style="background: #fff; overflow: auto" id="apidoc-list" kendo-layout="1"></div>

      </div>
      <div data-role="layoutmanager" data-orientation="vertical" kendo-layout="1">
        <table class="project-toolbar k-toolbar" cellspacing="10">
          <tr>
            <td><h1 class="project-title">Select/create project</h1></td>
            <td>
              <div style="float: right">
                <button onclick="withSelectedProject(projectLintJavaScript)"
                        class="k-button">JSHint</button>
                <button onclick="withSelectedProject(projectLintKendo)"
                        class="k-button">Kendo Lint</button>
                <button onclick="withSelectedProject(projectEditDependencies)"
                        class="k-button">Dependencies</button>
                <button onclick="withSelectedProject(rebuildProject)"
                        class="k-button">Compile</button>
                <button onclick="withSelectedProject(optimizeImages)"
                        class="k-button">Optimize images</button>
                <button onclick="withSelectedProject(projectAddFile)"
                        class="k-button">Add file</button>
                <button onclick="withSelectedProject(projectBuildKendo)"
                        class="k-button">Build Kendo</button>
                |
                <button onclick="withSelectedProject(projectBuildDistro)"
                        class="k-button">Bundle</button>
              </div>
            </td>
          </tr>
        </table>
        <div id="content" kendo-layout="1" style="overflow: auto"></div>
        <div id="console" kendo-layout="25%,resizable" style="overflow: auto"></div>
      </div>
    </div>

    <!-- TEMPLATES -->

    <script type="x/yajet-template" class="simple-list-item">
      <div class="simple-list-item" value="${this.id}">${this.name}</div>
    </script>

    <script type="x/yajet-template" class="project-view">
      $( var p = this )

      $(BLOCK plink(file, text)$-
        $(LET ((info => p.file_info[file])
               (date => info && info.date))
          <a target="PROJECTPREVIEW"
             title="$date|html"
             href="${ p.make_link(file) => html }">${ text || file => html }</a>$)$)

      $(BLOCK display_files(files_by_type)
        $(MAPHASH (type, files => files_by_type)
          <tr class="file-type">
            <td>$type (project files)</td>
            <td>$type (library files)</td>
          </tr>
          $(BLOCK showfiles(lib)
            $(AWHEN (files.filter(function(f){ return !!f.lib == !!lib }))
              <ul>
                $(FOREACH (f => it)
                  <li>
                    ${ plink(f.name) }
                    $(LET ((finfo => p.file_info[f.name]))
                      (${ finfo.size } bytes$-
                      $(WHEN (!f.lib)$-
                        ; <a href="#" command="edit-file" project-id="$p.id|html" filename="$f.name|html">edit</a>$)$-
                        , <a href="#" command="deps-file" project-id="$p.id|html" file-id="$f.id|html">deps</a>$-
                        , <a href="#" command="props-file" project-id="$p.id|html" file-id="$f.id|html">props</a>$-
                        )
                      $(WHEN (!finfo.library && finfo.canbuild)
                        →
                        $(AIF (finfo.build)
                          <span class="build">
                            ${ plink(it.rel) } ($it.size bytes)$-
                            $(WHEN (it.dirty), <span class="warn">outdated</span>$)
                          </span>
                        $(ELSE)
                          <span class="warn">not built</span>
                        $)
                      $)
                    $)
                  </li>
                $)
              </ul>
            $)
          $)
          <tr>
            <td>
              ${ showfiles(false) }
            </td>
            <td>
              ${ showfiles(true) }
            </td>
          </tr>
        $)
      $)

      <table class="project-files">
        ${ display_files(p.files) }
      </table>
    </script>

    <script type="x/yajet-template" class="add-file-dialog">
      $( var p = this )
      <form action="/@add-file/$p.id|html/"
            target="--add-file"
            method="POST"
            enctype="multipart/form-data">
        <input type="hidden" name="project" value="$p.id|html" />
        <input type="hidden" name="expect" value="$p.expect|html" />
        <p>
          <label>
            File name (relative to project directory):<br />
            <input autocomplete="off" class="k-input k-editable" name="filename" style="width: 25em" type="text" />
          </label>
        </p>
        <p style="text-align: center">
          <label class="display-full-path">$p.path|html</label>
        </p>
        <p>
          <label>
            Upload content (optional):<br />
            <input type="file" name="file" />
          </label>
        </p>
        <p>
          <label>
            <input type="checkbox" name="library" />
            This is a library file
          </label>
          <br />
          <label>
            <input type="checkbox" name="page" />
            This is a Web page
          </label>
        </p>
        $(PROCESS ok_cancel_buttons())
      </form>
      <iframe id="--add-file" style="display: none" src="about:blank"></iframe>
    </script>

    <script type="x/yajet-template" class="new-project-dialog">
      <p>
        <label>
          Project name:<br />
          <input autocomplete="off" name="name" style="width: 25em" class="k-input k-editable" type="text" />
        </label>
      </p>
      <p>
        <label>
          Project directory:<br />
          <input autocomplete="off" name="path" style="width: 25em"
                 class="k-input k-editable" type="text"
                 value="${ this.destination => html }/" />
          <button data-bind="click: onBrowse">...</button>
        </label>
      </p>
      <p>
        <label>
          Project ID:<br />
          <input autocomplete="off" name="id" style="width: 10em" class="k-input k-editable" type="text" />
        </label>
      </p>
      <p class="confirm" style="display: none">
        <label>
          <input type="checkbox" name="confirm" /> Confirm new project in non-empty directory
        </label>
      </p>
      $(PROCESS ok_cancel_buttons())
    </script>

    <script type="x/yajet-template" class="confirm-dialog">
      <p style="font-size: 120%; font-weight: bold">
        $(IF (this.htmlMessage) $this.htmlMessage $(ELSE) $this.message|html $)
      </p>
      $(PROCESS ok_cancel_buttons())
    </script>

    <script type="x/yajet-template" class="build-errors-dialog">
      <div data-role="layoutmanager" data-orientation="vertical" class="layout">
        <div kendo-layout="1" style="overflow: auto">
          <table class="build-errors" style="width: 100%">
            <thead>
              <tr>
                <td>File</td>
                <td>Error</td>
                <td>Location</td>
              </tr>
            </thead>
            <tbody>
              $(FOREACH (err => this.errors)
              <tr>
                <td><b>${ err.filename => html }</b></td>
                <td>${ err.message => html }</td>
                <td style="white-space: nowrap">
                  <a href="#" command="edit-file"
                     project-id="$this.proj_id"
                     filename="$err.filename|html"
                     line="$err.line"
                     $(AIF (err.col) col="$it"$)>line $err.line$(AIF (err.col), col $it$)</a>
                </td>
              </tr>
              $)
            </tbody>
          </table>
        </div>
        <div class="dlg-buttons">
          <button class="k-button btn-close">Close</button>
        </div>
      </div>
    </script>

    <script type="x/yajet-template" class="project-deps-dialog">
      <div class="project-deps-dialog"
           data-role="layoutmanager" data-orientation="vertical">
        <div class="project-deps" kendo-layout="1"
             data-role="layoutmanager" data-orientation="horizontal">
          <div class="left-files" kendo-layout="50%"></div>
          <div class="deps" kendo-layout="1"
               data-role="layoutmanager" data-orientation="vertical">
            <div class="title">
              Chose a file on the left, then select its direct dependencies
              below.
            </div>
            <div kendo-layout="1" class="deps-select" style="overflow: auto"></div>
          </div>
        </div>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

    <script type="x/yajet-template" class="project-file-deps-dialog">
      <div class="project-deps-dialog" data-role="layoutmanager" data-orientation="vertical">
        <div class="title">Select below direct dependencies of $this.name|html:</div>
        <div kendo-layout="1" class="deps-select" style="overflow: auto"></div>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

    <script type="x/yajet-template" class="kendo-widget-usage-dialog">
      <div data-role="layoutmanager" data-orientation="vertical" class="layout">
        <div kendo-layout="1" style="overflow: auto">
          <p>Detected components in use:</p>

          <ul class="two-columns">$(FOREACH (w => this.components)
            <li>$w.id|html</li>
          $)</ul>

          $(AIF (this.manual)
            <p>Other manually selected components:</p>
            <ul class="two-columns">$(FOREACH (w => it) <li>$w|html</li> $)</ul>$)

          <p>If you require additional components please mark them below.</p>

          <div class="two-columns">
            $(FOREACH (comp => this.kcomp)
            $(WHEN (comp.category == "web" || comp.category == "framework")
            <div>
              $( var checked = this.selection.contains(comp.id) ? 'checked="checked"' : '';
                 var disabled = this.detected.contains(comp.id) ? 'disabled="disabled"' : ''; )
              <label class="hovering"
                     title="${ comp.description || 'No description provided' => html }">
                <input id="kcomp-$comp.id|html" type="checkbox" value="$comp.id|html" $checked $disabled />
                $comp.name|html ($comp.category|html)
              </label>
              </div>$)$)
          </div>
        </div>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

    <script type="x/yajet-template" class="build-distro-dialog">
      <div>
        <h2>Select build type:</h2>
        <p>
          <label>
            <input type="radio" name="build-type" value="prod" checked="checked" />
            Production build (compiled/minified files)
          </label>
        </p>
        <p>
          <label>
            <input type="radio" name="build-type" value="prod,concat" />
            Production build (compiled/minified files, concatenated JS)
          </label>
        </p>
        <p>
          <label>
            <input type="radio" name="build-type" value="devel" />
            Development build (readable project files)
          </label>
        </p>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

    <script type="x/yajet-template" class="template-library">

      $(EXPORT ok_cancel_buttons()
        <div class="dlg-buttons">
          <button class="k-button btn-ok"
                  $(IF (this.mvvm) data-bind="click: onOK" $)
                  >${ this.okLabel || this.closeLabel || "OK" => html }</button>
          $(UNLESS (this.closeLabel)
            <button class="k-button btn-cancel"
                    $(IF (this.mvvm) data-bind="click: onCancel" $)
                    >${ this.cancelLabel || "Cancel" => html }</button>$)
        </div>$)

      $(EXPORT console_message(m)$-
        <div class="message $(AIF (m.class) $it $)">
          $(IF (m.filename)
            <div class="filename"
                 command="edit-file"
                 project-id="$m.proj_id|html"
                 filename="$m.filename|html"
                 $(IF (m.line) line="$m.line"$)
                 $(IF (m.col) col="$m.col"$)
                 >$m.filename|html$-
              <span class="location">$(IF (m.line):<span class="line">$m.line</span>$-
                $(IF (m.col),<span class="col">$m.col</span>$)$)</span>
            </div>$)
          <div class="body">
            $(AIF (m.cprefix) <span class="prefix">$it|html:</span> $)
            $m.message|html
          </div>
        </div>$)

      $(EXPORT docbrowser_index(comp)
        <h2>$comp.name|html</h2>
        $(BLOCK show_section(section, link_prefix, title)
          $(AWHEN (comp[section])
            <h3>$title|html</h3>
            <ul>
              $(FOREACH (i => it)
                <li><a href="#$link_prefix|html-$i.name|html">$i.name|html</a></li>
              $)
            </ul>
          $)
        $)
        ${ show_section("config", "configuration", "Configuration") }
        ${ show_section("fields", "fields", "Fields") }
        ${ show_section("methods", "methods", "Methods") }
        ${ show_section("events", "events", "Events") }
      $)

    </script>

    <!-- careful about the $- below.  Whitespace is important (in that it must be erased). -->
    <script type="x/yajet-template" class="console-message">$-
      $(PROCESS console_message(this))
    </script>

    <script type="x/yajet-template" class="docbrowser-dialog">
      <div data-role="layoutmanager" data-orientation="vertical" class="layout">
        <div class="docbrowser-toolbar k-toolbar" kendo-layout="0px,after:5">
          <button class="k-button" data-bind="click: onHistoryPrev">« Back</button>
          <button class="k-button" data-bind="click: onHistoryNext">Next »</button>
        </div>
        <div data-role="layoutmanager" kendo-layout="1">
          <div kendo-layout="20%,resizable" class="docbrowser-index"></div>
          <div kendo-layout="1" class="docbrowser-content"></div>
        </div>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

    <script type="x/yajet-template" class="filepicker-dialog">
      <div data-role="window" class="filepicker-dialog"
           data-actions="[ 'Minimize', 'Maximize', 'Close' ]"
           data-title="${ this.title || 'Browse' => html }"
           data-modal="true"
           data-width="${ this.width || 600 }"
           data-height="${ this.height || 400 }"
           data-bind="events: { resize: dlgResize }">
        <div data-role="layoutmanager" data-orientation="vertical" class="layout">
          $(AWHEN (this.infoText) <div kendo-layout="0px,after:5">$it</div> $)
          <div kendo-layout="30px,after:5"
               class="k-toolbar toolbar"
               data-role="layoutmanager" data-orientation="horizontal" data-spacing="5">
            <input class="border-box search" kendo-layout="1" />
            <button title="Back to previous folder" data-bind="click: onBack" class="icon empty back-directory k-button"></button>
            <button title="Up one level" data-bind="click: onUpFolder" class="icon empty up-directory k-button"></button>
            $(WHEN (this.newFolder)
            <button title="New folder" data-bind="click: onNewFolder" class="icon empty new-directory k-button"></button>$)
          </div>
          <div class="status" kendo-layout="0px,after:5">
            In <span class="current-path">$this.path|html</span>
          </div>
          <div kendo-layout="1" class="filesystem-grid"
               data-selectable="true"
               data-role="grid" data-sortable="true" data-navigatable="true"

               data-bind="source: filelist,
                          events: { edit: onGridEdit,
                                    save: onGridSave,
                                    cancel: onGridCancel,
                                    change: onGridChange,
                                    }"

               data-columns="[ { field: 'rel', title: 'Name',
                                 template: select_file.template_name,
                                 sortable: { compare: select_file.compare_name },
                                 },
                               { field: 'stat.size', title: 'Size', width: '100px',
                                 template: select_file.template_stat_size,
                                 sortable: { compare: select_file.compare_stat_size },
                                 }
                             ]">
          </div>
          <div class="dlg-buttons">
            $(AWHEN (this.moreButtons)
              $(FOREACH (btn => it)
                <button style="float: left; white-space: nowrap; width: auto" class="k-button"
                        data-bind="click: moreButtons_$btn.handler_name">$btn.label</button>$)$)
            <button class="k-button btn-ok" data-bind="events: { click: onOK }">
              ${ this.okLabel || this.closeLabel || "OK" => html }
            </button>
            <button class="k-button btn-cancel" data-bind="events: { click: onCancel }">
              ${ this.cancelLabel || "Cancel" => html }
            </button>
          </div>
        </div>
      </div>
    </script>

    <script type="x/yajet-template" class="fileprops-dialog">
      <div data-role="window" data-title="File properties" data-modal="true" data-resizable="false">
        <p>
          <label>
            File name (relative to project directory):<br />
            <input readonly class="k-input k-editable" name="name" style="width: 20em" data-bind="value: f_name" />
          </label>
        </p>
        <p>
          <label>
            File type:<br />
            <select name="type" data-role="dropdownlist" data-bind="value: f_type">
              <option value="">Unknown</option>
              <option value="js">JavaScript</option>
              <option value="css">CSS</option>
              <option value="less">LESS</option>
              <option value="coffee">CoffeeScript</option>
              <option value="html">HTML</option>
            </select>
          </label>
        </p>
        <p>
          <label class="hovering">
            <input type="checkbox" name="lib" data-bind="checked: f_lib" />
            This is a library file
          </label>
        </p>
        <p>
          <label class="hovering">
            <input type="checkbox" name="page" data-bind="checked: f_page" />
            This is a Web page
          </label>
        </p>
        <p>
          <label class="hovering">
            <input type="checkbox" name="remote" data-bind="checked: f_remote" />
            This is a remote file (enter URL below)
          </label>
        </p>
        <p>
          <label>
            Remote file URL:<br />
            <input class="k-input k-editable" name="url" data-bind="value: f_url" style="width: 20em" />
          </label>
        </p>
        <p>
          <label>
            <input type="checkbox" data-bind="checked: f_download" />
            Download file locally on build.
          </label>
        </p>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

    <script type="x/yajet-template" class="add-remote-file-dialog">
      <div data-role="window" data-title="Add remote file" data-modal="true" data-resizable="false">
        <p>
          <label>
            Select library, or just paste the URL below.<br />
            <select name="library" data-role="dropdownlist"
                    data-bind="source: libraries, value: library, events: { change: onLibraryChange }"
                    data-text-field="name" data-value-field="id">
            </select>
          </label>
        </p>
        <p>
          <label>
            Remote file URL:<br />
            <input class="k-input k-editable" data-bind="value: url" style="width: 20em" />
          </label>
        </p>
        <p>
          <label>
            <input type="checkbox" data-bind="checked: download" />
            Download file locally on build.
          </label>
        </p>
        <p>
          <label>
            Local name for this file:<br />
            <input data-bind="value: filename" style="width: 20em" />
          </label>
        </p>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

    <script type="x/yajet-template" class="bootstrapper-settings-dialog">
      <div data-role="window" data-title="Settings" data-modal="true">
        <h2>Editor configuration</h2>
        <p>
          <label>
            Editor (executable):<br />
            <input class="k-input k-editable" style="width: 20em" data-bind="value: editor.path" />
            <button class="k-button" title="Browse" data-bind="click: onBrowse">...</button>
          </label>
        </p>
        <p style="max-width: 25em">
          There are 3 editor commands.  One that takes only the filename
          (<tt><b>{file}</b></tt>), the second takes a line number
          (<tt><b>{line}</b></tt>), and the third also receives a column
          number (<tt><b>{col}</b></tt>).  Customize the arguments in the
          fields below.
        </p>
        <p>
          <label>
            Editor command 1:
            <input class="k-input k-editable" data-bind="value: editor.args.cmd1" />
          </label>
        </p>
        <p>
          <label>
            Editor command 2:
            <input class="k-input k-editable" data-bind="value: editor.args.cmd2" />
          </label>
        </p>
        <p>
          <label>
            Editor command 3:
            <input class="k-input k-editable" data-bind="value: editor.args.cmd3" />
          </label>
        </p>
        $(PROCESS ok_cancel_buttons())
      </div>
    </script>

  </body>
</html>
