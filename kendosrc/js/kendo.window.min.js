("function"==typeof define&&define.amd?define:function(e,i){return i()})(["./kendo.draganddrop.min"],function(){(function(e,i){function t(e){return e!==i}function n(e,i,t){return Math.max(Math.min(e,t),i)}function o(e,i){var t=e.children(b);return t.data("kendoWindow")||t.data("kendo"+i)}function r(i){return e(k).filter(function(){var t=e(this),n=o(t,i);return n.options.modal&&t.is(H)&&n.options.visible}).sort(function(i,t){return+e(i).css("zIndex")-+e(t).css("zIndex")})}function s(e,i){return function(){var e=this,t=e.wrapper,n=t[0].style,o=e.options;if(!o.isMaximized&&!o.isMinimized)return e.restoreOptions={width:n.width,height:n.height},t.find(x).hide().end().find(G).parent().hide().eq(0).before(Q.action({name:"Restore"})),i.call(e),e}}function a(e){var i=this;i.owner=e,i._draggable=new p(e.wrapper,{filter:x,group:e.wrapper.id+"-resizing",dragstart:f(i.dragstart,i),drag:f(i.drag,i),dragend:f(i.dragend,i)})}function d(e){var i=this;i.owner=e,i._draggable=new p(e.wrapper,{filter:z,group:e.wrapper.id+"-moving",dragstart:f(i.dragstart,i),drag:f(i.drag,i),dragend:f(i.dragend,i),dragcancel:f(i.dragcancel,i)})}var l=window.kendo,c=l.ui.Widget,p=l.ui.Draggable,h=e.isPlainObject,f=e.proxy,m=e.extend,u=e.each,g=l.template,w="body",v=".kendoWindow",k=".k-window",y=".k-window-title",z=y+"bar",b=".k-window-content",x=".k-resize-handle",_=".k-overlay",T="k-content-frame",W="k-loading",M="k-state-hover",C="k-state-focused",H=":visible",O="hidden",P="cursor",S="open",D="activate",I="deactivate",L="close",R="refresh",A="resize",F="dragstart",q="dragend",j="error",E="overflow",N="zIndex",G=".k-window-actions .k-i-minimize,.k-window-actions .k-i-maximize",U=".k-window-titlebar .k-window-action",K=l.isLocalUrl,B=c.extend({init:function(i,n){var o,r,s,p,m,g,w,x=this,_=!1;c.fn.init.call(x,i,n),n=x.options,i=x.element,m=n.content,x.appendTo=e(n.appendTo||document.body),x._animations(),m&&!h(m)&&(m=n.content={url:m}),i.find("script").filter(function(){return!this.type||this.type.toLowerCase().indexOf("script")>=0}).remove(),i.parent().is(x.appendTo)||(i.is(H)?(r=i.offset(),_=!0):(s=i.css("visibility"),p=i.css("display"),i.css({visibility:O,display:""}),r=i.offset(),i.css({visibility:s,display:p}))),t(n.visible)&&null!==n.visible||(n.visible=i.is(H)),o=x.wrapper=i.closest(k),i.is(".k-content")&&o[0]||(i.addClass("k-window-content k-content"),x._createWindow(i,n),o=x.wrapper=i.closest(k),x._dimensions()),r&&o.css({top:r.top,left:r.left}),m&&x.refresh(m),n.visible&&x.toFront(),g=o.children(b),x._tabindex(g),n.visible&&n.modal&&x._overlay(o.is(H)).css({opacity:.5}),o.on("mouseenter"+v,U,function(){e(this).addClass(M)}).on("mouseleave"+v,U,function(){e(this).removeClass(M)}).on("click"+v,U,f(x._windowActionHandler,x)),g.on("keydown"+v,f(x._keydown,x)).on("focus"+v,function(){o.addClass(C)}).on("blur"+v,function(){o.removeClass(C)}),n.resizable&&(o.on("dblclick"+v,z,f(x.toggleMaximization,x)),u("n e s w se sw ne nw".split(" "),function(e,i){o.append(Q.resizeHandle(i))}),x.resizing=new a(x)),n.draggable&&(x.dragging=new d(x)),w=i.attr("id"),w&&(w+="_wnd_title",o.find(z).children(y).attr("id",w),g.attr({role:"dialog","aria-labelledby":w})),o.add(o.find(".k-resize-handle,.k-window-titlebar")).on("mousedown"+v,f(x.toFront,x)),x.touchScroller=l.touchScroller(i),x._resizeHandler=function(e){return x._onDocumentResize(e)},e(window).on("resize",x._resizeHandler),n.visible&&(x.trigger(S),x.trigger(D)),l.notify(x)},_dimensions:function(){var e=this,i=e.wrapper,t=e.element,n=e.options;e.title(n.title),n.width&&i.width(n.width),n.height&&i.height(n.height),u(["minWidth","minHeight","maxWidth","maxHeight"],function(e,i){var o=n[i];o&&1/0!=o&&t.css(i,o)}),n.visible||i.hide()},_animations:function(){var e=this.options;e.animation===!1&&(e.animation={open:{effects:{}},close:{hide:!0,effects:{}}})},setOptions:function(e){c.fn.setOptions.call(this,e),this._animations(),this._dimensions()},events:[S,D,I,L,R,A,F,q,j],options:{name:"Window",animation:{open:{effects:{zoom:{direction:"in"},fade:{direction:"in"}},duration:350},close:{effects:{zoom:{direction:"out",properties:{scale:.7}},fade:{direction:"out"}},duration:350,hide:!0}},title:"",actions:["Close"],modal:!1,resizable:!0,draggable:!0,minWidth:90,minHeight:50,maxWidth:1/0,maxHeight:1/0,visible:null},_closable:function(){return e.inArray("close",e.map(this.options.actions,function(e){return e.toLowerCase()}))>-1},_keydown:function(e){var i,t,o,r,s=this,a=s.options,d=l.keys,c=e.keyCode,p=s.wrapper,h=10,f=s.options.isMaximized;e.target==e.currentTarget&&(c==d.ESC&&s._closable()&&s._close(!0),!a.draggable||e.ctrlKey||f||(i=l.getOffset(p),c==d.UP?t=p.css("top",i.top-h):c==d.DOWN?t=p.css("top",i.top+h):c==d.LEFT?t=p.css("left",i.left-h):c==d.RIGHT&&(t=p.css("left",i.left+h))),a.resizable&&e.ctrlKey&&!f&&(c==d.UP?(t=!0,r=p.height()-h):c==d.DOWN&&(t=!0,r=p.height()+h),c==d.LEFT?(t=!0,o=p.width()-h):c==d.RIGHT&&(t=!0,o=p.width()+h),t&&(p.css({width:n(o,a.minWidth,a.maxWidth),height:n(r,a.minHeight,a.maxHeight)}),s.trigger(A))),t&&e.preventDefault())},_overlay:function(i){var t=this.appendTo.children(".k-overlay"),n=this.wrapper;return t.length||(t=e("<div class='k-overlay' />")),t.insertBefore(n[0]).toggle(i).css(N,parseInt(n.css(N),10)-1),t},_windowActionHandler:function(t){var n=e(t.target).closest(".k-window-action").find(".k-icon"),o=this;u({"k-i-close":function(){o._close(!0)},"k-i-maximize":o.maximize,"k-i-minimize":o.minimize,"k-i-restore":o.restore,"k-i-refresh":o.refresh},function(e,r){return n.hasClass(e)?(t.preventDefault(),r.call(o),!1):i})},center:function(){var i=this.wrapper,t=e(window);return i.css({left:t.scrollLeft()+Math.max(0,(t.width()-i.width())/2),top:t.scrollTop()+Math.max(0,(t.height()-i.height())/2)}),this},title:function(e){var i=this,t=i.wrapper,n=i.options,o=t.find(z),r=o.children(y),s=o.outerHeight();return arguments.length?(e===!1?(t.addClass("k-window-titleless"),o.remove()):(o.length||t.prepend(Q.titlebar(m(Q,n))),t.css("padding-top",s),o.css("margin-top",-s)),r.text(e),i):r.text()},content:function(e){var i=this.wrapper.children(b);return e?(i.html(e),this):i.html()},open:function(){var i,t=this,n=t.wrapper,o=t.options,r=o.animation.open,s=n.children(b),a=s.css(E);return t.trigger(S)||(t.toFront(),t.element.focus(),o.visible=!0,o.modal&&(i=t._overlay(!1),r.duration?i.kendoStop().kendoAnimate({effects:"fade:in",duration:r.duration}):i.css("opacity",.5).show()),n.is(H)||(s.css(E,O),n.show().kendoStop().kendoAnimate({effects:r.effects,duration:r.duration,complete:function(){t.element.focus(),t.trigger(D),s.css(E,a)}}))),o.isMaximized&&(t._documentScrollTop=e(document).scrollTop(),e("html, body").css(E,O)),t},_close:function(t){var n,s,a,d=this,l=d.wrapper,c=d.options,p=c.animation.open,h=c.animation.close;l.is(H)&&!d.trigger(L,{userTriggered:!!t})&&(c.visible=!1,e(k).each(function(i,t){var n=e(t),o=n.find(b);t!=l&&o.find("> ."+T).length>0&&o.children(".k-overlay").remove()}),n=r(c.name),s=c.modal&&!n.length,a=c.modal?d._overlay(!0):e(i),s?h.duration?a.kendoStop().kendoAnimate({effects:"fade:out",duration:h.duration,hide:!0}):a.hide():n.length&&o(n.eq(n.length-1),c.name)._overlay(!0),l.kendoStop().kendoAnimate({effects:h.effects||p.effects,reverse:h.reverse===!0,duration:h.duration,complete:function(){l.hide(),d.trigger(I)}})),d.options.isMaximized&&(e("html, body").css(E,""),d._documentScrollTop&&d._documentScrollTop>0&&e(document).scrollTop(d._documentScrollTop))},close:function(){return this._close(!1),this},toFront:function(i){var t,n,o,r=this,s=r.wrapper,a=s[0],d=+s.css(N),l=d,c=r.element,p=i&&i.target?i.target:null;try{t=document.activeElement}catch(h){}return e(k).each(function(i,t){var n=e(t),o=n.css(N),r=n.find(b);isNaN(o)||(d=Math.max(+o,d)),t!=a&&r.find("> ."+T).length>0&&r.append(Q.overlay)}),(10001==d||d>l)&&s.css(N,d+2),r.element.find("> .k-overlay").remove(),e(t).is(c)||e(p).is(U+","+U+" .k-icon,:input")||c.find(t).length&&c.find(p).length||(c.focus(),n=e(window).scrollTop(),o=parseInt(r.wrapper.position().top,10),o>0&&0>o-n&&(n>0?e(window).scrollTop(o):r.wrapper.css("top",n))),r},toggleMaximization:function(){return this[this.options.isMaximized?"restore":"maximize"]()},restore:function(){var i=this,t=i.options,n=i.restoreOptions;if(t.isMaximized||t.isMinimized)return i.wrapper.css({position:"absolute",left:n.left,top:n.top,width:n.width,height:n.height}).find(".k-window-content,.k-resize-handle").show().end().find(".k-window-titlebar .k-i-restore").parent().remove().end().end().find(G).parent().show(),e("html, body").css(E,""),this._documentScrollTop&&this._documentScrollTop>0&&e(document).scrollTop(this._documentScrollTop),t.isMaximized=t.isMinimized=!1,i.trigger(A),i},maximize:s("maximize",function(){var i=this,t=i.wrapper,n=t.position();m(i.restoreOptions,{left:n.left,top:n.top}),t.css({left:0,top:0,position:"fixed"}),this._documentScrollTop=e(document).scrollTop(),e("html, body").css(E,O),i.options.isMaximized=!0,i._onDocumentResize()}),minimize:s("minimize",function(){var e=this;e.wrapper.css("height",""),e.element.hide(),e.options.isMinimized=!0}),_onDocumentResize:function(){var i=this,t=i.wrapper,n=e(window);i.options.isMaximized&&(t.css({width:n.width(),height:n.height()-parseInt(t.css("padding-top"),10)}),i.trigger(A))},refresh:function(i){var n,o,r,s=this,a=s.options,d=e(s.element);return h(i)||(i={url:i}),i=m({},a.content,i),o=t(a.iframe)?a.iframe:i.iframe,r=i.url,r?(t(o)||(o=!K(r)),o?(n=d.find("."+T)[0],n?n.src=r||n.src:d.html(Q.contentFrame(m({},a,{content:i}))),d.find("."+T).unbind("load"+v).on("load"+v,function(){s.trigger(R)})):s._ajaxRequest(i)):(i.template&&s.content(g(i.template)({})),s.trigger(R)),s},_ajaxRequest:function(i){var t=this,n=i.template,o=t.wrapper.find(".k-window-titlebar .k-i-refresh"),r=setTimeout(function(){o.addClass(W)},100);e.ajax(m({type:"GET",dataType:"html",cache:!1,error:f(function(e,i){t.trigger(j,{status:i,xhr:e})},t),complete:function(){clearTimeout(r),o.removeClass(W)},success:f(function(e){n&&(e=g(n)(e||{})),t.element.html(e).prop("scrollTop",0),t.trigger(R)},t)},i))},destroy:function(){var i,t,n=this;c.fn.destroy.call(n),l.destroy(n.wrapper),n.resizing&&n.resizing.destroy(),n.dragging&&n.dragging.destroy(),n.element.children("iframe").remove(),n.wrapper.remove().add(n.wrapper.find(".k-resize-handle,.k-window-titlebar")).off(v),e(window).off("resize",n._resizeHandler),i=r(),t=n.options.modal&&!i.length,t?n._overlay(!1).remove():i.length>0&&o(i.eq(i.length-1),n.options.name)._overlay(!0)},_createWindow:function(){var i,t,n=this,o=n.element,r=n.options,s=l.support.isRtl(o);r.scrollable===!1&&o.attr("style","overflow:hidden;"),t=e(Q.wrapper(r)),r.title!==!1&&t.append(Q.titlebar(m(Q,r))),i=o.find("iframe:not(.k-content)").map(function(){var e=this.getAttribute("src");return this.src="",e}),t.toggleClass("k-rtl",s).appendTo(n.appendTo).append(o).find("iframe:not(.k-content)").each(function(e){this.src=i[e]}),t.find(".k-window-title").css(s?"left":"right",t.find(".k-window-actions").outerWidth()+10),o.show()}}),Q={wrapper:g("<div class='k-widget k-window' />"),action:g("<a role='button' href='\\#' class='k-window-action k-link'><span role='presentation' class='k-icon k-i-#= name.toLowerCase() #'>#= name #</span></a>"),titlebar:g("<div class='k-window-titlebar k-header'>&nbsp;<span class='k-window-title'>#= title #</span><div class='k-window-actions'># for (var i = 0; i < actions.length; i++) { ##= action({ name: actions[i] }) ## } #</div></div>"),overlay:"<div class='k-overlay' />",contentFrame:g("<iframe frameborder='0' title='#= title #' class='"+T+"' "+"src='#= content.url #'>"+"This page requires frames in order to show content"+"</iframe>"),resizeHandle:g("<div class='k-resize-handle k-resize-#= data #'></div>")};a.prototype={dragstart:function(i){var t=this,n=t.owner,o=n.wrapper;t.elementPadding=parseInt(n.wrapper.css("padding-top"),10),t.initialCursorPosition=l.getOffset(o,"position"),t.resizeDirection=i.currentTarget.prop("className").replace("k-resize-handle k-resize-",""),t.initialSize={width:o.width(),height:o.height()},t.containerOffset=l.getOffset(n.appendTo),o.append(Q.overlay).find(x).not(i.currentTarget).hide(),e(w).css(P,i.currentTarget.css(P))},drag:function(e){var i,t,o,r,s=this,a=s.owner,d=a.wrapper,l=a.options,c=s.resizeDirection,p=s.containerOffset,h=s.initialCursorPosition,f=s.initialSize,m=e.x.location,u=e.y.location;c.indexOf("e")>=0?(i=m-h.left,d.width(n(i,l.minWidth,l.maxWidth))):c.indexOf("w")>=0&&(r=h.left+f.width,i=n(r-m,l.minWidth,l.maxWidth),d.css({left:r-i-p.left,width:i})),c.indexOf("s")>=0?(t=u-h.top-s.elementPadding,d.height(n(t,l.minHeight,l.maxHeight))):c.indexOf("n")>=0&&(o=h.top+f.height,t=n(o-u,l.minHeight,l.maxHeight),d.css({top:o-t-p.top,height:t})),a.trigger(A)},dragend:function(i){var t=this,n=t.owner,o=n.wrapper;return o.find(_).remove().end().find(x).not(i.currentTarget).show(),e(w).css(P,""),n.touchScroller&&n.touchScroller.reset(),27==i.keyCode&&o.css(t.initialCursorPosition).css(t.initialSize),!1},destroy:function(){this._draggable.destroy()}},d.prototype={dragstart:function(i){var t=this.owner,n=t.element,o=n.find(".k-window-actions"),r=l.getOffset(t.appendTo);t.trigger(F),t.initialWindowPosition=l.getOffset(t.wrapper,"position"),t.startPosition={left:i.x.client-t.initialWindowPosition.left,top:i.y.client-t.initialWindowPosition.top},t.minLeftPosition=o.length>0?o.outerWidth()+parseInt(o.css("right"),10)-n.outerWidth():20-n.outerWidth(),t.minLeftPosition-=r.left,t.minTopPosition=-r.top,t.wrapper.append(Q.overlay).find(x).hide(),e(w).css(P,i.currentTarget.css(P))},drag:function(i){var t=this.owner,n={left:Math.max(i.x.client-t.startPosition.left,t.minLeftPosition),top:Math.max(i.y.client-t.startPosition.top,t.minTopPosition)};e(t.wrapper).css(n)},_finishDrag:function(){var i=this.owner;i.wrapper.find(x).toggle(!i.options.isMinimized).end().find(_).remove(),e(w).css(P,"")},dragcancel:function(e){this._finishDrag(),e.currentTarget.closest(k).css(this.owner.initialWindowPosition)},dragend:function(){return this._finishDrag(),this.owner.trigger(q),!1},destroy:function(){this._draggable.destroy()}},l.ui.plugin(B)})(window.kendo.jQuery)});